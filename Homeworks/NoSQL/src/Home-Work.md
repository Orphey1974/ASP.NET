# Домашнее задание: Добавить NoSQL базу в микросервис

## Цель

Домашнее задание поможет получить навыки работы с NoSQL базами данных и распределенным кэшем в микросервисном варианте проекта.

## Описание/Пошаговая инструкция выполнения домашнего задания

1. Сделать форк репозитория и реализовать ДЗ в нем
2. Необходимо подключить NoSQL базу данных к одному из микросервисов или распределенный кеш на Redis, на выбор

## Варианты реализации

### MongoDB

В качестве NoSQL базы можно использовать MongoDB и перенести туда данные и работу с ними для одного из микросервисов на выбор: модуля Администрирование либо модуля Предложение промокодов клиентам.

MongoDB образ нужно будет добавить в docker-compose:
```yaml
image: "mongo:4.2.3"
```

#### Модуль "Администрирование"

В модуле Администрирование (`Otus.Teaching.Pcf.Administration`) нужно:
- Изменить хранение сущностей `Employee` и `Role` в MongoDB
- Реализовать новый репозиторий для работы с MongoDB
- Обеспечить работу текущих контроллеров с новым хранилищем

#### Модуль "Предложение промокодов клиентам"

Если хочется лучше познакомиться с MongoDB, то можно реализовать более сложный функционал из микросервиса Предложение промокодов клиентам (`Otus.Teaching.Pcf.GivingToCustomer`). Необходимо:
- Перенести хранение сущностей в MongoDB вместо PostgreSQL
- Реализовать функционал, приведенный в контроллерах на новом хранилище

### Redis

Если вместо MongoDB хочется поработать с Redis, то в Redis кэш можно перенести справочник предпочтений `Preference` и во всех микросервисах обращаться к этим данным через Redis кэш и интерфейс `IDistributedCache`.

#### Вариант 1: Отдельный микросервис (рекомендуемый)

Так как предпочтения сейчас нужны в двух микросервисах, то при получении промокода от партнера и при выдаче клиентам выглядит правильным реализовать микросервис со справочной информацией, где:
- Сохранять предпочтения в СУБД
- Для быстрого доступа использовать распределенный кеш или локальный кеш микросервиса

Тогда сервис справочной информации нужно будет:
- Добавить в docker-compose
- Сделать его сборку в Dockerfile по аналогии с другими сервисами
- При получении данных предпочтений в `Otus.Teaching.Pcf.GivingToCustomer` и `Otus.Teaching.Pcf.ReceivingFromPartner` вызывать новый микросервис, который будет использовать кеш

#### Вариант 2: Упрощенная реализация

Для простоты реализации кеш можно добавить только в один из текущих микросервисов и вместо базы получать предпочтения из него.

## Инструкция по запуску

Проект состоит из трех микросервисов и их баз данных, настройка PostgreSQL баз для них приведена в docker-compose файле в корне репозитория.

### Запуск только баз данных

```bash
docker-compose up promocode-factory-administration-db promocode-factory-receiving-from-partner-db promocode-factory-giving-to-customer-db
```

### Запуск сервисов

- Сами сервисы доступны в общем solution: `Otus.Teaching.Pcf.sln`
- Если базы данных запущены, то в Visual Studio или Rider настраиваем запуск нескольких проектов сразу
- Работаем с API через Swagger, для API в Swagger добавлены примеры данных для вызова и тестирования

## Критерии оценки

### Вариант с MongoDB

- **Работа с MongoDB реализована в сервисе Администрирование**: 8 баллов
- **Работа с MongoDB реализована в сервисе Предложение промокодов клиентам**: 10 баллов (*)

### Вариант с Redis

- **Работа с Redis реализована в одном из микросервисов**: 8 баллов
- **Работа с Redis реализована в отдельном микросервисе со справочной информацией**, а микросервисы `Otus.Teaching.Pcf.GivingToCustomer` и `Otus.Teaching.Pcf.ReceivingFromPartner` вызывают его для получения предпочтений: 10 баллов (*)

**Минимальный проходной балл: 8**
